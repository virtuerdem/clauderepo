
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."CREATE_PARTITIONS_TABLE" (XTABLE_NAME VARCHAR2,XDATA_DATE  DATE,XEND_DATE DATE) 
  AS
BEGIN
/*
-- Bu Select cumlesi partition i create ettikten sonra partition olusturma islemini takip icin kullanilir.
SELECT TABLE_NAME,DATA_DATE
FROM
(
SELECT TABLE_NAME, MAX(DATA_DATE) DATA_DATE
FROM NORTHI_TABLE_PARTITION_LIST
GROUP BY TABLE_NAME
)
WHERE DATA_DATE<TO_DATE('31.01.2010','DD.MM.YYYY')

*/

 
    FOR XPRT  IN
    (
        SELECT  *
        FROM (

        SELECT TABLE_NAME,TABLE_NAME AGG_TABLE,PARTITION_TYPE 
        FROM NORTHI_LOADER_SETTINGS B,(SELECT DISTINCT PARTITION_ID,PARTITION_TYPE FROM NORTHI_PARTITION_TYPE) C
        WHERE  B.PARTITION_ID=C.PARTITION_ID AND B.TABLE_NAME=XTABLE_NAME
        )
        WHERE AGG_TABLE IN (SELECT DISTINCT TABLE_NAME FROM NORTHI_TABLE_PARTITION_LIST )
    )
    LOOP
         
            IF INSTR(XPRT.AGG_TABLE,'5WA')>0 OR INSTR(XPRT.AGG_TABLE,'_5MA')>0 OR INSTR(XPRT.AGG_TABLE,'7WA')>0 OR INSTR(XPRT.AGG_TABLE,'7MA')>0 THEN
                LOADER_CREATION.ADD_TABLE_PARTITION('NORTHI_DATA.'||XPRT.AGG_TABLE,XPRT.TABLE_NAME ,XDATA_DATE,XEND_DATE,7);
            ELSIF INSTR(XPRT.AGG_TABLE,'_DA')>0 THEN
                LOADER_CREATION.ADD_TABLE_PARTITION('NORTHI_DATA.'||XPRT.AGG_TABLE,XPRT.TABLE_NAME ,XDATA_DATE,XEND_DATE,1);
            ELSE
                LOADER_CREATION.ADD_TABLE_PARTITION('NORTHI_DATA.'||XPRT.AGG_TABLE,XPRT.TABLE_NAME ,XDATA_DATE,XEND_DATE,XPRT.PARTITION_TYPE);
         END IF;
    END LOOP;
END;
/
