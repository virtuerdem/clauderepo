
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."NOKIA_PCRF_HOURLY_PROCESS" 
AS
XDATE DATE;

BEGIN

    XDATE:= TRUNC(SYSDATE,'HH24')-3/24;
    WHILE XDATE<= TRUNC(SYSDATE,'HH24')

   LOOP

        --------------VDF-----------------
        
        DELETE FROM NORTHI_DATA.NOKIA_PCRF WHERE FRAGMENT_DATE = XDATE;
        
        DELETE FROM NORTHI_LOADER.NORTHI_TABLE_LOGS WHERE TABLE_NAME = 'NOKIA_PCRF' AND FRAGMENT_DATE = XDATE;

        COMMIT; 

        
        UPDATE NORTHI_LOADER_PROCESS SET LOADER_STATE=0, LOADER_COUNT=1 WHERE ORG_TABLE='NOKIA_PCRF' AND DATA_DATE = XDATE;
               
        XDATE:=XDATE + 1 /24;
        
        COMMIT;
        
        ----------------------------------

  END LOOP;
  
END;
/
