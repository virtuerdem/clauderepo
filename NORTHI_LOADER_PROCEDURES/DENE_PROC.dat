
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."DENE_PROC" (XTABLE_NAME VARCHAR2,XKPI_NAMES VARCHAR2)
AS
XTABLE VARCHAR2(32000);
BEGIN 
FOR XVENDORS IN 
(
            SELECT DISTINCT B.VENDOR_ID
            FROM (SELECT DISTINCT A.TABLE_NAME NI_TABLE, B.TABLE_NAME RAW_TABLE, RAW_COUNTER
                  FROM VIEW_KPI_COUNTER_DEVISION A, ALL_TAB_COLUMNS B
                 WHERE     A.RAW_COUNTER = B.COLUMN_NAME
                       AND A.TABLE_NAME = XTABLE_NAME
                       AND A.KPI_NAME  IN (XKPI_NAMES)
                       ) A,
               NORTHI_LOADER_SETTINGS B
            WHERE     INSTR (B.FROM_CLAUSE||' ', A.RAW_TABLE||' ') > 0
               AND B.TABLE_NAME =  XTABLE_NAME
               AND A.NI_TABLE = B.TABLE_NAME
) LOOP
    XTABLE:='';
    FOR XTABLES IN (
            SELECT DISTINCT A.NI_TABLE, A.RAW_TABLE, B.VENDOR_ID
            FROM (SELECT DISTINCT A.TABLE_NAME NI_TABLE, B.TABLE_NAME RAW_TABLE, RAW_COUNTER
                  FROM VIEW_KPI_COUNTER_DEVISION A, ALL_TAB_COLUMNS B
                 WHERE     A.RAW_COUNTER = B.COLUMN_NAME
                       AND A.TABLE_NAME = XTABLE_NAME
                       AND A.KPI_NAME  IN ( XKPI_NAMES)
                       ) A,
               NORTHI_LOADER_SETTINGS B
            WHERE     INSTR (B.FROM_CLAUSE||' ', A.RAW_TABLE||' ') > 0
               AND B.TABLE_NAME =  XTABLE_NAME
               AND A.NI_TABLE = B.TABLE_NAME
               AND VENDOR_ID=XVENDORS.VENDOR_ID
    )LOOP
        XTABLE:=XTABLE||XTABLES.RAW_TABLE||',';
    END LOOP;
    INSERT INTO NORTHI_LOADER_ERROR_LOG(SQLTEXT)
    VALUES(XTABLE);
    COMMIT;
END LOOP; 
END;
/
