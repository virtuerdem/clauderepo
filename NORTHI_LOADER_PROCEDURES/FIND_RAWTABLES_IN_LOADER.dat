
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."FIND_RAWTABLES_IN_LOADER" 
AS
   xsql   VARCHAR2 (3000);
BEGIN
   FOR xTABLES
      IN (SELECT TABLE_NAME, VENDOR_ID
            FROM NORTHI_LOADER.NORTHI_LOADER_sETTINGS
           WHERE     FROM_CLAUSE LIKE ('%HIZIR2%')
                 AND FROM_CLAUSE NOT LIKE ('%NORTHI_PARSER%')
                 AND ACTIVE = 1)
   LOOP
      xsql :=
            'INSERT INTO USED_RAW_TABLES (TABLE_NAME,VENDOR_ID,PARENT_NAME)
            SELECT TABLE_NAME,VENDOR_ID, replace(UPPER(regexp_substr(FROM_CLAUSE, ''HIZIR2[^ \n]*'', 1, LEVEL)),''HIZIR2.'','''') AS cikarilan_metin
FROM (SELECT TABLE_NAME , VENDOR_ID , REPLACE(upper(FROM_CLAUSE),''WHERE'','' '') FROM_CLAUSE FROM NORTHI_LOADER.NORTHI_LOADER_sETTINGS WHERE table_name IN ('''
         || xTABLES.TABLE_NAME
         || ''') 
AND VENDOR_ID='
         || xTABLES.VENDOR_ID
         || ') CONNECT BY LEVEL <= regexp_count(FROM_CLAUSE, ''HIZIR2[^ \n]*'')';

      EXECUTE IMMEDIATE xsql;
      

      --INSERT INTO NORTHI_DATA.TEST_ERROR (ADD_DATE,PROCEDURE_NAME,SQLTEXT) VALUES (SYSDATE,'LOADER_PARENTS',xsql);commit;

      COMMIT;
      
      UPDATE NORTHI_LOADER.USED_RAW_TABLES
        SET PARENT_NAME =  REGEXP_REPLACE(PARENT_NAME, '[[:space:]]+', '')
        WHERE LENGTH(REGEXP_REPLACE(PARENT_NAME, '[[:space:]]+', ''))!= LENGTH(PARENT_NAME); 
        commit;
        
   END LOOP;
END;
/
