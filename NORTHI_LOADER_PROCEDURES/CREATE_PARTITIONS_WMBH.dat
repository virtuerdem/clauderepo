
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."CREATE_PARTITIONS_WMBH" 
AS
XDATA_DATE DATE;
XEND_DATE DATE;
BEGIN
/*
-- Bu Select cumlesi partition i create ettikten sonra partition olusturma islemini takip icin kullanilir.
SELECT TABLE_NAME,DATA_DATE
FROM
(
SELECT TABLE_NAME, MAX(DATA_DATE) DATA_DATE
FROM NORTHI_TABLE_PARTITION_LIST
GROUP BY TABLE_NAME
)
WHERE DATA_DATE<TO_DATE('31.01.2010','DD.MM.YYYY')

*/

XEND_DATE:=TO_DATE('01.01.2016','DD.MM.YYYY');

    FOR XPRT  IN
    (
        SELECT DISTINCT TABLE_NAME, A.AGG_TYPE||'_'||TABLE_NAME AGG_TABLE,PARTITION_TYPE
        FROM
        (
                SELECT 'MBH5' AGG_TYPE  FROM DUAL
                UNION ALL SELECT 'WBH7' AGG_TYPE  FROM DUAL
                UNION ALL SELECT 'WBH5' AGG_TYPE  FROM DUAL
                UNION ALL SELECT 'MBH7' AGG_TYPE  FROM DUAL
        ) A,NORTHI_LOADER_SETTINGS B,(SELECT DISTINCT PARTITION_ID,PARTITION_TYPE FROM NORTHI_PARTITION_TYPE) C
        WHERE B.PARTITION_ID=C.PARTITION_ID AND B.ACTIVE=1 AND
        TABLE_NAME IN (SELECT DISTINCT TABLE_NAME FROM NORTHI_BH_SETTINGS)

    )
    LOOP
        SELECT ADD_MONTHS(MAX(DATA_DATE),1) DATA_DATE INTO XDATA_DATE FROM NORTHI_TABLE_PARTITION_LIST WHERE TABLE_NAME=XPRT.AGG_TABLE;
        IF XDATA_DATE<= XEND_DATE THEN
            IF    INSTR(XPRT.AGG_TABLE,'WBH5')>0 OR INSTR(XPRT.AGG_TABLE,'WBH7')>0 OR INSTR(XPRT.AGG_TABLE,'MBH5')>0 OR INSTR(XPRT.AGG_TABLE,'MBH7')>0 THEN
                    BH_CREATION.ADD_BH_TABLE_PARTITION('NORTHI_DATA.'||XPRT.AGG_TABLE,XPRT.TABLE_NAME ,XDATA_DATE,XEND_DATE,7);
            END IF;
        END IF;
    END LOOP;
END; 
/
