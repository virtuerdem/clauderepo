
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."CREATE_UNIQUE_TABLE_PARTITIONS" 
AS
XDATA_DATE DATE;
XEND_DATE DATE;
BEGIN
/*
-- Bu Select cumlesi partition i create ettikten sonra partition olusturma islemini takip icin kullanilir.
SELECT TABLE_NAME,DATA_DATE
FROM
(
SELECT TABLE_NAME, MAX(DATA_DATE) DATA_DATE
FROM NORTHI_TABLE_PARTITION_LIST
GROUP BY TABLE_NAME
)
WHERE DATA_DATE<TO_DATE('31.01.2010','DD.MM.YYYY')

*/

XEND_DATE:=ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),2);

    FOR XPRT  IN
    (
       SELECT 'TESTT' TABLE_NAME,'TESTT' AGG_TABLE,0  PARTITION_TYPE
       FROM DUAL
    )
    LOOP
        SELECT MAX(DATA_DATE)+1/24 INTO XDATA_DATE FROM NORTHI_TABLE_PARTITION_LIST WHERE TABLE_NAME=XPRT.AGG_TABLE;
        IF XDATA_DATE< XEND_DATE THEN
                LOADER_CREATION.ADD_TABLE_PARTITION('NORTHI_DATA.'||XPRT.AGG_TABLE,XPRT.TABLE_NAME ,XDATA_DATE,TO_DATE('01.07.2011 23','DD.MM.YYYY HH24'),XPRT.PARTITION_TYPE);
        END IF;
    END LOOP;
END;
/
