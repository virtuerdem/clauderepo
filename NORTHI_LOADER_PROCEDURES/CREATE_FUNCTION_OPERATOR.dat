
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."CREATE_FUNCTION_OPERATOR" 
AS
SQLSTR VARCHAR2 (32000);
BEGIN
    SQLSTR:= 'CREATE OR REPLACE FUNCTION RETURN_OPERATOR_ID(XVAL IN VARCHAR2)RETURN NUMBER
    AS XVAR NUMBER;
     BEGIN XVAR:= 0; ';
    FOR XOPS IN
    (
        SELECT OPERATOR_ID, REPLACE(CONDITION,'CONDITION','XVAL') CONDITION, OPERATOR_NAME
        FROM NORTHI_DATA.CGR_OPERATOR_CONDITIONS_NSS
        WHERE OPERATOR_ID<>1
    )
    LOOP
        SQLSTR:=SQLSTR||'IF ';
        SQLSTR:=SQLSTR||XOPS.CONDITION;
        SQLSTR:=SQLSTR||' THEN RETURN '||XOPS.OPERATOR_ID||'; END IF; ';
    END LOOP;
    SQLSTR:=SQLSTR||' RETURN XVAR; END;';
    INSERT INTO NORTHI_LOADER_ERROR_LOG(SQLTEXT) VALUES(SQLSTR);
    COMMIT;
    EXECUTE IMMEDIATE SQLSTR;
END; 
/
