
  CREATE OR REPLACE EDITIONABLE PROCEDURE "NORTHI_LOADER"."HM_TOT_DATA_TRAFF_BURSA" 
AS

BEGIN 

DELETE /*+ PARALLEL */  NORTHI_DATA.HM_TOT_DATA_TRAFF_BURSA;
COMMIT;

INSERT /*+ PARALLEL */ INTO NORTHI_DATA.HM_TOT_DATA_TRAFF_BURSA
(BSC_NAME, BTS_NAME, CELL_NAME, CONG_1, CONG_2, CONG_3, CONG_4, CONG_5, CONG_6, CONG_7, CONG_8, CONG_9, CONG_10, CONG_11, CONG_12, CONG_13, CONG_14, CONG_15, CONG_16, CONG_17, CONG_18, CONG_19, CONG_20, DCR_NUMM, CNT, CNT_20)
SELECT A.*,B.DCR_NUMM,C.CNT ,D.CNT_20
FROM 

     (SELECT 
          BSC_NAME,BTS_NAME, CELL_NAME,
             
             SUM(DECODE(FD, TRUNC(SYSDATE-20), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_1,
             SUM(DECODE(FD, TRUNC(SYSDATE-19), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_2,
             SUM(DECODE(FD, TRUNC(SYSDATE-18), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_3,
             SUM(DECODE(FD, TRUNC(SYSDATE-17), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_4,
             SUM(DECODE(FD, TRUNC(SYSDATE-16), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_5,
             SUM(DECODE(FD, TRUNC(SYSDATE-15), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_6,
             SUM(DECODE(FD, TRUNC(SYSDATE-14), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_7,
             SUM(DECODE(FD, TRUNC(SYSDATE-13), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_8,
             SUM(DECODE(FD, TRUNC(SYSDATE-12), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_9,
             SUM(DECODE(FD, TRUNC(SYSDATE-11), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_10,
             SUM(DECODE(FD, TRUNC(SYSDATE-10), HM_TOT_2G_DATA_TRAFF_KB,'')) CONG_11,
             SUM(DECODE(FD, TRUNC(SYSDATE-9), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_12,
             SUM(DECODE(FD, TRUNC(SYSDATE-8), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_13 ,
             SUM(DECODE(FD, TRUNC(SYSDATE-7), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_14,
             SUM(DECODE(FD, TRUNC(SYSDATE-6), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_15,
             SUM(DECODE(FD, TRUNC(SYSDATE-5), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_16,
             SUM(DECODE(FD, TRUNC(SYSDATE-4), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_17,
             SUM(DECODE(FD, TRUNC(SYSDATE-3), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_18,
             SUM(DECODE(FD, TRUNC(SYSDATE-2), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_19,
             SUM(DECODE(FD, TRUNC(SYSDATE-1), HM_TOT_2G_DATA_TRAFF_KB,''))  CONG_20  
            
             FROM
           
       (      
      SELECT TRUNC(FRAGMENT_DATE) FD,
      CELL_NAME,BTS_NAME,BSC_NAME,
      ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) HM_TOT_2G_DATA_TRAFF_KB
FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
(
SELECT 
NETWORK_ID
FROM NORTHI_DATA.DBH_CELLSTS TTT 
WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24
AND ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) = 0
)  AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24  
   )
GROUP BY BSC_NAME,BTS_NAME,CELL_NAME
) A
LEFT OUTER JOIN
(
SELECT 
      BSC_NAME,BTS_NAME,CELL_NAME,   
      ROUND(AVG(DCR_VF_NUM),2) DCR_NUMM 
FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
(
SELECT
NETWORK_ID
FROM NORTHI_DATA.DBH_CELLSTS TTT 
WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24

AND ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) = 0

)  AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24
GROUP BY  BSC_NAME,BTS_NAME,CELL_NAME
) B
ON  (A.BSC_NAME=B.BSC_NAME AND A.BTS_NAME=B.BTS_NAME AND A.CELL_NAME=B.CELL_NAME)
LEFT OUTER JOIN 
(
SELECT  CELL_NAME,BTS_NAME,BSC_NAME, CNT
FROM 
(
    SELECT CELL_NAME,BTS_NAME,BSC_NAME, COUNT(*) CNT
    FROM
    (
     SELECT TRUNC(FRAGMENT_DATE) FD, 
          CELL_NAME,BTS_NAME,BSC_NAME,
          ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) HM_TOT_2G_DATA_TRAFF_KB
    FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
    WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
    (
    SELECT 
    NETWORK_ID
    FROM NORTHI_DATA.DBH_CELLSTS TTT 
    WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24
    AND ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) = 0
      ) AND ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) = 0 AND FRAGMENT_DATE>=ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-3)
    )
    GROUP BY CELL_NAME,BTS_NAME,BSC_NAME
)
   
) C ON
(B.BSC_NAME=C.BSC_NAME AND B.BTS_NAME=C.BTS_NAME AND B.CELL_NAME=C.CELL_NAME)
LEFT OUTER JOIN 
(SELECT  CELL_NAME,BTS_NAME,BSC_NAME, CNT_20
FROM 
(
    SELECT CELL_NAME,BTS_NAME,BSC_NAME, COUNT(*) CNT_20
    FROM
    (
     SELECT TRUNC(FRAGMENT_DATE) FD, 
          CELL_NAME,BTS_NAME,BSC_NAME,
          ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) HM_TOT_2G_DATA_TRAFF_KB
    FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
    WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
    (
    SELECT 
    NETWORK_ID
    FROM NORTHI_DATA.DBH_CELLSTS TTT 
    WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24
    AND ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) = 0
    ) AND ROUND ( (  DLRLCEGTRAFF_VF + ULRLCEGTRAFF_VF + DLRLCGTRAFF_VF  + ULRLCGTRAFF_VF), 2 ) = 0 AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24 
    )
    GROUP BY CELL_NAME,BTS_NAME,BSC_NAME
)) D  
ON
(C.BSC_NAME=D.BSC_NAME AND C.BTS_NAME=D.BTS_NAME AND C.CELL_NAME=D.CELL_NAME)
order by cong_20 desc;

COMMIT;

DELETE /*+ PARALLEL */  NORTHI_DATA.SHM_PS_ASS_FAIL_BURSA;
COMMIT;

INSERT /*+ PARALLEL */  INTO NORTHI_DATA.SHM_PS_ASS_FAIL_BURSA
(BSC_NAME, BTS_NAME, CELL_NAME, CONG_1, CONG_2, CONG_3, CONG_4, CONG_5, CONG_6, CONG_7, CONG_8, CONG_9, CONG_10, CONG_11, CONG_12, CONG_13, CONG_14, CONG_15, CONG_16, CONG_17, CONG_18, CONG_19, CONG_20, DCR_NUMM, CNT, CNT_20)
SELECT A.*,B.DCR_NUMM,C.CNT ,D.CNT_20
FROM 

     (SELECT 
          BSC_NAME,BTS_NAME, CELL_NAME,
             
             SUM(DECODE(FD, TRUNC(SYSDATE-20), SHM_PS_ASS_FAIL,'')) CONG_1,
             SUM(DECODE(FD, TRUNC(SYSDATE-19), SHM_PS_ASS_FAIL,'')) CONG_2,
             SUM(DECODE(FD, TRUNC(SYSDATE-18), SHM_PS_ASS_FAIL,'')) CONG_3,
             SUM(DECODE(FD, TRUNC(SYSDATE-17), SHM_PS_ASS_FAIL,'')) CONG_4,
             SUM(DECODE(FD, TRUNC(SYSDATE-16), SHM_PS_ASS_FAIL,'')) CONG_5,
             SUM(DECODE(FD, TRUNC(SYSDATE-15), SHM_PS_ASS_FAIL,'')) CONG_6,
             SUM(DECODE(FD, TRUNC(SYSDATE-14), SHM_PS_ASS_FAIL,'')) CONG_7,
             SUM(DECODE(FD, TRUNC(SYSDATE-13), SHM_PS_ASS_FAIL,'')) CONG_8,
             SUM(DECODE(FD, TRUNC(SYSDATE-12), SHM_PS_ASS_FAIL,'')) CONG_9,
             SUM(DECODE(FD, TRUNC(SYSDATE-11), SHM_PS_ASS_FAIL,'')) CONG_10,
             SUM(DECODE(FD, TRUNC(SYSDATE-10), SHM_PS_ASS_FAIL,'')) CONG_11,
             SUM(DECODE(FD, TRUNC(SYSDATE-9), SHM_PS_ASS_FAIL,'')) CONG_12,
             SUM(DECODE(FD, TRUNC(SYSDATE-8), SHM_PS_ASS_FAIL,'')) CONG_13 ,
             SUM(DECODE(FD, TRUNC(SYSDATE-7), SHM_PS_ASS_FAIL,'')) CONG_14,
             SUM(DECODE(FD, TRUNC(SYSDATE-6), SHM_PS_ASS_FAIL,'')) CONG_15,
             SUM(DECODE(FD, TRUNC(SYSDATE-5), SHM_PS_ASS_FAIL,'')) CONG_16,
             SUM(DECODE(FD, TRUNC(SYSDATE-4), SHM_PS_ASS_FAIL,'')) CONG_17,
             SUM(DECODE(FD, TRUNC(SYSDATE-3), SHM_PS_ASS_FAIL,'')) CONG_18,
             SUM(DECODE(FD, TRUNC(SYSDATE-2), SHM_PS_ASS_FAIL,'')) CONG_19,
             SUM(DECODE(FD, TRUNC(SYSDATE-1), SHM_PS_ASS_FAIL,'')) CONG_20  
            
             FROM
           
       (      
      SELECT TRUNC(FRAGMENT_DATE) FD,
      CELL_NAME,BTS_NAME,BSC_NAME,
      ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) SHM_PS_ASS_FAIL
FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
(
SELECT 
NETWORK_ID
FROM NORTHI_DATA.DBH_CELLSTS TTT 
WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24
AND ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) > 5
)  AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24  
         
        
ORDER BY BSC_NAME,BTS_NAME,CELL_NAME

   )
GROUP BY BSC_NAME,BTS_NAME,CELL_NAME
ORDER BY 1,2,3) A
LEFT OUTER JOIN
(
SELECT 
      BSC_NAME,BTS_NAME,CELL_NAME,   
      ROUND(AVG(DCR_VF_NUM),2) DCR_NUMM 
FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
(
SELECT
NETWORK_ID
FROM NORTHI_DATA.DBH_CELLSTS TTT 
WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24

AND ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) > 5

)  AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24
GROUP BY  BSC_NAME,BTS_NAME,CELL_NAME
ORDER BY BSC_NAME,BTS_NAME,CELL_NAME
) B
ON  (A.BSC_NAME=B.BSC_NAME AND A.BTS_NAME=B.BTS_NAME AND A.CELL_NAME=B.CELL_NAME)
LEFT OUTER JOIN 
(
SELECT CELL_NAME,BTS_NAME,BSC_NAME, CNT
FROM 
(
    SELECT CELL_NAME,BTS_NAME,BSC_NAME, COUNT(*) CNT
    FROM
    (
     SELECT TRUNC(FRAGMENT_DATE) FD, 
          CELL_NAME,BTS_NAME,BSC_NAME,
          ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) SHM_PS_ASS_FAIL
    FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
    WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
    (
    SELECT 
    NETWORK_ID
    FROM NORTHI_DATA.DBH_CELLSTS TTT 
    WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24 
    AND ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) > 5
      ) AND ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) > 5 AND FRAGMENT_DATE>=ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-3)
    ORDER BY BSC_NAME,BTS_NAME,CELL_NAME,FD
    )
    GROUP BY CELL_NAME,BTS_NAME,BSC_NAME
)
   
) C ON
(B.BSC_NAME=C.BSC_NAME AND B.BTS_NAME=C.BTS_NAME AND B.CELL_NAME=C.CELL_NAME)
LEFT OUTER JOIN 
(SELECT CELL_NAME,BTS_NAME,BSC_NAME, CNT_20
FROM 
(
    SELECT CELL_NAME,BTS_NAME,BSC_NAME, COUNT(*) CNT_20
    FROM
    (
     SELECT TRUNC(FRAGMENT_DATE) FD, 
          CELL_NAME,BTS_NAME,BSC_NAME,
          ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) SHM_PS_ASS_FAIL
    FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
    WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
    (
    SELECT 
    NETWORK_ID
    FROM NORTHI_DATA.DBH_CELLSTS TTT 
    WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24 
    AND ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) > 5
    ) AND ROUND ( 100 - (ROUND ( DECODE ( (PACASSFAILR_VF_DENOM), 0, 100, (PACASSFAILR_VF_NUM) * 100 / (PACASSFAILR_VF_DENOM) ),  2  )),  2  ) > 5 AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24 
    ORDER BY BSC_NAME,BTS_NAME,CELL_NAME,FD
    )
    GROUP BY CELL_NAME,BTS_NAME,BSC_NAME
)) D  
ON
(C.BSC_NAME=D.BSC_NAME AND C.BTS_NAME=D.BTS_NAME AND C.CELL_NAME=D.CELL_NAME)
order by cong_20 desc;

COMMIT;

DELETE /*+ PARALLEL */  NORTHI_DATA.HM_TOTAL_CALLS_BURSA;
COMMIT;

INSERT /*+ PARALLEL */  INTO NORTHI_DATA.HM_TOTAL_CALLS_BURSA
(BSC_NAME, BTS_NAME, CELL_NAME, CONG_1, CONG_2, CONG_3, CONG_4, CONG_5, CONG_6, CONG_7, CONG_8, CONG_9, CONG_10, CONG_11, CONG_12, CONG_13, CONG_14, CONG_15, CONG_16, CONG_17, CONG_18, CONG_19, CONG_20, DCR_NUMM, CNT, CNT_20)
SELECT A.*,B.DCR_NUMM,C.CNT ,D.CNT_20
FROM 

     (SELECT 
          BSC_NAME,BTS_NAME, CELL_NAME,
             
             SUM(DECODE(FD, TRUNC(SYSDATE-20), HM_TOTAL_CALLS,'')) CONG_1,
             SUM(DECODE(FD, TRUNC(SYSDATE-19), HM_TOTAL_CALLS,'')) CONG_2,
             SUM(DECODE(FD, TRUNC(SYSDATE-18), HM_TOTAL_CALLS,'')) CONG_3,
             SUM(DECODE(FD, TRUNC(SYSDATE-17), HM_TOTAL_CALLS,'')) CONG_4,
             SUM(DECODE(FD, TRUNC(SYSDATE-16), HM_TOTAL_CALLS,'')) CONG_5,
             SUM(DECODE(FD, TRUNC(SYSDATE-15), HM_TOTAL_CALLS,'')) CONG_6,
             SUM(DECODE(FD, TRUNC(SYSDATE-14), HM_TOTAL_CALLS,'')) CONG_7,
             SUM(DECODE(FD, TRUNC(SYSDATE-13), HM_TOTAL_CALLS,'')) CONG_8,
             SUM(DECODE(FD, TRUNC(SYSDATE-12), HM_TOTAL_CALLS,'')) CONG_9,
             SUM(DECODE(FD, TRUNC(SYSDATE-11), HM_TOTAL_CALLS,'')) CONG_10,
             SUM(DECODE(FD, TRUNC(SYSDATE-10), HM_TOTAL_CALLS,'')) CONG_11,
             SUM(DECODE(FD, TRUNC(SYSDATE-9), HM_TOTAL_CALLS,'')) CONG_12,
             SUM(DECODE(FD, TRUNC(SYSDATE-8), HM_TOTAL_CALLS,'')) CONG_13 ,
             SUM(DECODE(FD, TRUNC(SYSDATE-7), HM_TOTAL_CALLS,'')) CONG_14,
             SUM(DECODE(FD, TRUNC(SYSDATE-6), HM_TOTAL_CALLS,'')) CONG_15,
             SUM(DECODE(FD, TRUNC(SYSDATE-5), HM_TOTAL_CALLS,'')) CONG_16,
             SUM(DECODE(FD, TRUNC(SYSDATE-4), HM_TOTAL_CALLS,'')) CONG_17,
             SUM(DECODE(FD, TRUNC(SYSDATE-3), HM_TOTAL_CALLS,'')) CONG_18,
             SUM(DECODE(FD, TRUNC(SYSDATE-2), HM_TOTAL_CALLS,'')) CONG_19,
             SUM(DECODE(FD, TRUNC(SYSDATE-1), HM_TOTAL_CALLS,'')) CONG_20  
            
             FROM
           
       (      
      SELECT TRUNC(FRAGMENT_DATE) FD,
      CELL_NAME,BTS_NAME,BSC_NAME,
      ROUND ( (TCH_NORMSEIZS), 2) HM_TOTAL_CALLS
FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
WHERE BH_TYPE = 1 AND TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
(
SELECT 
NETWORK_ID
FROM NORTHI_DATA.DBH_CELLSTS TTT 
WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24
AND ROUND ( (TCH_NORMSEIZS), 2)=0
)  AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24  
         
        
ORDER BY BSC_NAME,BTS_NAME,CELL_NAME

   )
GROUP BY BSC_NAME,BTS_NAME,CELL_NAME
ORDER BY 1,2,3) A
LEFT OUTER JOIN
(
SELECT 
      BSC_NAME,BTS_NAME,CELL_NAME,   
      ROUND(AVG(DCR_VF_NUM),2) DCR_NUMM 
FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
(
SELECT
NETWORK_ID
FROM NORTHI_DATA.DBH_CELLSTS TTT 
WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24

AND ROUND ( (TCH_NORMSEIZS), 2)=0

)  AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24
GROUP BY  BSC_NAME,BTS_NAME,CELL_NAME
ORDER BY BSC_NAME,BTS_NAME,CELL_NAME
) B
ON  (A.BSC_NAME=B.BSC_NAME AND A.BTS_NAME=B.BTS_NAME AND A.CELL_NAME=B.CELL_NAME)
LEFT OUTER JOIN 
(
SELECT CELL_NAME,BTS_NAME,BSC_NAME, CNT
FROM 
(
    SELECT CELL_NAME,BTS_NAME,BSC_NAME, COUNT(*) CNT
    FROM
    (
     SELECT TRUNC(FRAGMENT_DATE) FD, 
          CELL_NAME,BTS_NAME,BSC_NAME,
          ROUND ( (TCH_NORMSEIZS), 2) HM_TOTAL_CALLS
    FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
    WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
    (
    SELECT 
    NETWORK_ID
    FROM NORTHI_DATA.DBH_CELLSTS TTT 
    WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24
    AND ROUND ( (TCH_NORMSEIZS), 2) = 0
      ) AND ROUND ( (TCH_NORMSEIZS), 2) = 0 AND FRAGMENT_DATE>=ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-3)
    ORDER BY BSC_NAME,BTS_NAME,CELL_NAME,FD
    )
    GROUP BY CELL_NAME,BTS_NAME,BSC_NAME
)
   
) C ON
(A.BSC_NAME=C.BSC_NAME AND A.BTS_NAME=C.BTS_NAME AND A.CELL_NAME=C.CELL_NAME)
LEFT OUTER JOIN 
(SELECT CELL_NAME,BTS_NAME,BSC_NAME, CNT_20
FROM 
(
    SELECT CELL_NAME,BTS_NAME,BSC_NAME, COUNT(*) CNT_20
    FROM
    (
     SELECT TRUNC(FRAGMENT_DATE) FD, 
          CELL_NAME,BTS_NAME,BSC_NAME,
          ROUND ( (TCH_NORMSEIZS), 2) HM_TOTAL_CALLS
    FROM NORTHI_DATA.DBH_CELLSTS TTT, NORTHI_DATA.OMC_BSC_BTS_CELL_LIST TT
    WHERE BH_TYPE = 1 AND  TT.CELL_ID = TTT.NETWORK_ID  AND NETWORK_ID IN 
    (
    SELECT 
    NETWORK_ID
    FROM NORTHI_DATA.DBH_CELLSTS TTT 
    WHERE BH_TYPE = 1 AND SUB_REGION_ID IN(  1204) AND TTT.FRAGMENT_DATE BETWEEN TRUNC(SYSDATE-1) AND TRUNC(SYSDATE-1)+23/24
    AND ROUND ( (TCH_NORMSEIZS), 2) = 0
    ) AND ROUND ( (TCH_NORMSEIZS), 2) = 0 AND FRAGMENT_DATE>TRUNC(SYSDATE-21)+23/24 
    ORDER BY BSC_NAME,BTS_NAME,CELL_NAME,FD
    )
    GROUP BY CELL_NAME,BTS_NAME,BSC_NAME
)) D  
ON
(A.BSC_NAME=D.BSC_NAME AND A.BTS_NAME=D.BTS_NAME AND A.CELL_NAME=D.CELL_NAME)
order by cong_20 desc;

COMMIT;


END; 
/
